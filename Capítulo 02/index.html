<html>
	<head>
		<title>Duncan's Just-In-Time Donuts</title>
		<link rel="stylesheet" type="text/css" href="css/estilo.css">
		<link rel="stylesheet" href="css/alertify/alertify.min.css" />
		<link rel="stylesheet" href="css/alertify/themes/default.min.css" />
		<script src="js/alertify/alertify.min.js"></script>
		<meta charset="utf-8"/>
	</head>

	<body onload="updateOrder();">
		<div id="frame">
				<h1>Duncan's Just-In-Time Donuts</h1>
			<div class="header">
				<h3>All donuts 50 cents each, cake or glazed!</h3>
			<div>

			<form name="orderForm" action="donuts.php" method="POST">
				<div class="field">
					Name: <input type="text" id="name" name="name" value="" onchange="updateOrder();" />
				<div>
				<div class="field">
					# of cake donuts: <input type="text" id="cakedonuts" name="cakedonuts" value="" onchange="updateOrder();" />
				<div>
				<div class="field">
					# of glazed donuts: <input type="text" id="glazeddonuts" name="glazeddonuts" value="" onchange="updateOrder();" />
				<div>
				<div class="field">
					Minutes 'til pickup: <input type="text" id="pickupminutes" name="pickupminutes" value="" onchange="updateOrder();" />
				<div>				
				<div class="field">
					Subtotal: <input type="text" id="subtotal" name="subtotal" value="" readonly />
				<div>
				<div class="field">
					Tax: <input type="text" id="tax" name="tax" value="" readonly />
				<div>
				<div class="field">
					Total: <input type="text" id="total" name="total" value="" readonly />
				<div>				
				<div class="field">
					<input type="button" id="buttonOrder" value="Place Order" onclick="placeOrder(this.form);" />
				<div>
			</form>
		</div>
	</body>	
	
	<script type="text/javascript">

		const TAXRATE 		= 0.0925;
		const DONUTPRICE 	= 0.50;
		const ATENCAO 		= "Atenção!";
			
		function updateOrder() {
			
			var numCakeDonuts 	= retornaValorInteiroDoElemento('cakedonuts');
			var numGlazedDonuts = retornaValorInteiroDoElemento('glazeddonuts');			
			var subTotal 		= calculaSubTotalDonuts(numCakeDonuts, numGlazedDonuts);	
			var tax 			= calculaTaxasDonuts(subTotal);
			var total 			= calculaTotalDonuts(subTotal, tax);
			
			document.getElementById('subtotal').value 	= '$ ' + subTotal.toFixed(2);
			document.getElementById('tax').value 		= '$ ' + tax.toFixed(2);
			document.getElementById('total').value 		= '$ ' + total.toFixed(2);
		}
		
		function retornaValorInteiroDoElemento(idElemento) {
		
			var valorInteiro = parseDonuts(document.getElementById(idElemento).value);
			
			if (isNaN(valorInteiro))
				valorInteiro = 0;
			
			return valorInteiro;
		}

		function parseDonuts(donutString){
			
			var numDonuts = parseInt(donutString);
			
			if(donutString.toLowerCase().indexOf('dozen') != -1 ||
			   donutString.toLowerCase().indexOf('dúzia') != -1)
				numDonuts *= 12;
			
			return numDonuts;
		}

		function calculaSubTotalDonuts(numCakeDonuts, numGlazedDonuts) {
			return (numCakeDonuts + numGlazedDonuts) * DONUTPRICE;
		}

		function calculaTaxasDonuts(subTotal) {
			return (subTotal) * TAXRATE;
		}

		function calculaTotalDonuts(subTotal, tax) {
			return subTotal + tax;
		}

		function placeOrder(form) {
			
			if(document.getElementById('name').value == '')
				alertify.alert(ATENCAO, 'Você precisa fornecer um nome antes de enviar o pedido!');
			else if (document.getElementById('pickupminutes').value == '' || isNaN(document.getElementById('pickupminutes').value))
				alertify.alert(ATENCAO, 'Você precisa fornecer o número de minutos até a coleta antes de enviar o pedido!');
			else
				form.submit();
		}

	</script>
</html>